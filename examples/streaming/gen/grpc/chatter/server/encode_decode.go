// Code generated by goa v2.0.0-wip, DO NOT EDIT.
//
// chatter GRPC server encoders and decoders
//
// Command:
// $ goa gen goa.design/goa/examples/streaming/design -o
// $(GOPATH)/src/goa.design/goa/examples/streaming

package server

import (
	"context"
	"strings"

	goa "goa.design/goa"
	chattersvc "goa.design/goa/examples/streaming/gen/chatter"
	chatterpb "goa.design/goa/examples/streaming/gen/grpc/chatter"
	goagrpc "goa.design/goa/grpc"
	"google.golang.org/grpc/metadata"
)

// EncodeLoginResponse encodes responses from the chatter login endpoint.
func EncodeLoginResponse(ctx context.Context, v interface{}) (interface{}, error) {
	res, ok := v.(string)
	if !ok {
		return nil, goagrpc.ErrInvalidType("chatter", "login", "string", v)
	}
	resp := NewLoginResponse(res)
	return resp, nil
}

// DecodeLoginRequest decodes requests sent to chatter login endpoint.
func DecodeLoginRequest(ctx context.Context, v interface{}) (interface{}, error) {
	var (
		payload *chattersvc.LoginPayload
		err     error
	)
	{
		var (
			user     string
			password string
		)
		{
			md, ok := metadata.FromIncomingContext(ctx)
			if ok {
				if vals := md.Get("user"); len(vals) == 0 {
					err = goa.MergeErrors(err, goa.MissingFieldError("user", "metadata"))
				} else {
					user = vals[0]
				}
				if vals := md.Get("password"); len(vals) == 0 {
					err = goa.MergeErrors(err, goa.MissingFieldError("password", "metadata"))
				} else {
					password = vals[0]
				}
			}
		}
		message, ok := v.(*chatterpb.LoginRequest)
		if !ok {
			return nil, goagrpc.ErrInvalidType("chatter", "login", "*chatterpb.LoginRequest", v)
		}
		payload = NewLoginPayload(message, user, password)
	}
	return payload, err
}

// DecodeEchoerRequest decodes requests sent to chatter echoer endpoint.
func DecodeEchoerRequest(ctx context.Context, v interface{}) (interface{}, error) {
	var (
		payload *chattersvc.EchoerPayload
		err     error
	)
	{
		var (
			token string
		)
		{
			md, ok := metadata.FromIncomingContext(ctx)
			if ok {
				if vals := md.Get("authorization"); len(vals) == 0 {
					err = goa.MergeErrors(err, goa.MissingFieldError("authorization", "metadata"))
				} else {
					token = vals[0]
				}
			}
		}
		payload = NewEchoerPayload(token)
		if strings.Contains(payload.Token, " ") {
			// Remove authorization scheme prefix (e.g. "Bearer")
			cred := strings.SplitN(payload.Token, " ", 2)[1]
			payload.Token = cred
		}
	}
	return payload, err
}

// DecodeListenerRequest decodes requests sent to chatter listener endpoint.
func DecodeListenerRequest(ctx context.Context, v interface{}) (interface{}, error) {
	var (
		payload *chattersvc.ListenerPayload
		err     error
	)
	{
		var (
			token string
		)
		{
			md, ok := metadata.FromIncomingContext(ctx)
			if ok {
				if vals := md.Get("authorization"); len(vals) == 0 {
					err = goa.MergeErrors(err, goa.MissingFieldError("authorization", "metadata"))
				} else {
					token = vals[0]
				}
			}
		}
		payload = NewListenerPayload(token)
		if strings.Contains(payload.Token, " ") {
			// Remove authorization scheme prefix (e.g. "Bearer")
			cred := strings.SplitN(payload.Token, " ", 2)[1]
			payload.Token = cred
		}
	}
	return payload, err
}

// DecodeSummaryRequest decodes requests sent to chatter summary endpoint.
func DecodeSummaryRequest(ctx context.Context, v interface{}) (interface{}, error) {
	var (
		payload *chattersvc.SummaryPayload
		err     error
	)
	{
		var (
			token string
		)
		{
			md, ok := metadata.FromIncomingContext(ctx)
			if ok {
				if vals := md.Get("authorization"); len(vals) == 0 {
					err = goa.MergeErrors(err, goa.MissingFieldError("authorization", "metadata"))
				} else {
					token = vals[0]
				}
			}
		}
		payload = NewSummaryPayload(token)
		if strings.Contains(payload.Token, " ") {
			// Remove authorization scheme prefix (e.g. "Bearer")
			cred := strings.SplitN(payload.Token, " ", 2)[1]
			payload.Token = cred
		}
	}
	return payload, err
}

// DecodeHistoryRequest decodes requests sent to chatter history endpoint.
func DecodeHistoryRequest(ctx context.Context, v interface{}) (interface{}, error) {
	var (
		payload *chattersvc.HistoryPayload
		err     error
	)
	{
		var (
			view  string
			token string
		)
		{
			md, ok := metadata.FromIncomingContext(ctx)
			if ok {
				if vals := md.Get("view"); len(vals) > 0 {
					view = vals[0]
				}
				if vals := md.Get("authorization"); len(vals) == 0 {
					err = goa.MergeErrors(err, goa.MissingFieldError("authorization", "metadata"))
				} else {
					token = vals[0]
				}
			}
		}
		message, ok := v.(*chatterpb.HistoryRequest)
		if !ok {
			return nil, goagrpc.ErrInvalidType("chatter", "history", "*chatterpb.HistoryRequest", v)
		}
		payload = NewHistoryPayload(message, view, token)
		if strings.Contains(payload.Token, " ") {
			// Remove authorization scheme prefix (e.g. "Bearer")
			cred := strings.SplitN(payload.Token, " ", 2)[1]
			payload.Token = cred
		}
	}
	return payload, err
}
